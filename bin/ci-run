#!/bin/sh
#
# CI Run
# 
# Usage: bin/ci-run
# 
# This will execute the steps from build to deploy. It's meant to be used on
# the CI server.
#
# Environment:
#   (Optional) AWS_PROFILE => Set which AWS profile is going to be used to
#     perform the S3 operations. This is recommended over using the access keys
#     directly.
#   (Optional) AWS_ACCESS_KEY_ID => If not using AWS profiles, this should
#     point to the key created by IAM.
#   (Optional) AWS_SECRET_ACCESS_KEY => If not using AWS profiles, this should
#     be the access secret of your key.
#   (Required) AWS_S3_BUCKET_NAME => The bucket name to which you want to push
#     the packages to. Ensure that you have write access to it.
#   (Required) REPO_NAME => The name of the repository file that you want to
#     add your built packages to.

# Go to the right path
cd "$(dirname "$0")/.." || exit

# Execute dotenv
# shellcheck disable=SC1091
. "./.env"

# shellcheck disable=SC1091
test -f "./.env.local" && . "./.env.local"

# Run the pipeline
bin/build
bin/deploy-to-s3
